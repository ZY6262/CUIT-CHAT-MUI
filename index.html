<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
    <title></title>
    <script src="js/mui.min.js"></script>
    <link href="css/mui.min.css" rel="stylesheet"/>
	<link href="css/header.css" rel="stylesheet" />
    
</head>
<body>
	<header class="mui-bar mui-bar-nav title">
		<h1 id="cuit_chat" class="title-color" style="padding: 0px; font-size: 17px; line-height: 35px;"><b>成信</b></h1>
	</header>
	
	<nav class="mui-bar mui-bar-tab">
		<a class="mui-tab-item mui-active" tabindex="0">
			<span class="mui-icon mui-icon-chat"></span>
			<span class="mui-tab-label">成信</span>
		</a>
		<a class="mui-tab-item" tabindex="1">
			<span class="mui-icon mui-icon-personadd"></span>
			<span class="mui-tab-label">通讯录</span>
		</a>
		<a class="mui-tab-item" tabindex="2">
			<span class="mui-icon mui-icon-navigate"></span>
			<span class="mui-tab-label">发现</span>
		</a>
		<a class="mui-tab-item" tabindex="3">
			<span class="mui-icon mui-icon-contact"></span>
			<span class="mui-tab-label">我的</span>
		</a>
	</nav>
</body>
	<script type="text/javascript" src="./js/app.js"></script>
	<script type="text/javascript" src="./js/fastdfs.js"></script>
	<script type="text/javascript" src="./js/myserver.js"></script>
	<script type="text/javascript" charset="utf-8">
	
      	mui.init();
		//  定义子页面数组
		var child_pages = [
				{
					pageUrl: "cuit-chat-list.html",
					pageId: "cuit-chat-list.html"
				},
				{
					pageUrl: "cuit-chat-contact.html",
					pageId: "cuit-chat-contact.html"
				},
				{
					pageUrl: "cuit-chat-discover.html",
					pageId: "cuit-chat-discover.html"
				},
				{
					pageUrl: "cuit-chat-mine.html",
					pageId: "cuit-chat-mine.html"
				}			
		];
		 
		function changeHeader(index){
			if (index == 0){
				cuit_chat.innerHTML = '成信';
			} else if (index == 1){
				cuit_chat.innerHTML = '通讯录';
			} else if (index == 2){
				cuit_chat.innerHTML = '发现';
			} else{
				cuit_chat.innerHTML = '我的';
			}
			
		};
		
		function initData(){
			var contact = plus.webview.getWebviewById('cuit-chat-contact.html');
			var mine = plus.webview.getWebviewById('cuit-chat-mine.html');
			
			mui.fire(contact, 'refresh');
			mui.fire(mine, 'refresh');
		};
		
		function listenNetworkChange(){
			document.addEventListener('netchange', function(){
				var currentNetworkStatus = plus.networkinfo.getCurrentType();
				if (currentNetworkStatus != 0 && currentNetworkStatus != 1){
					mui.toast('网络已重新连接...');
				} else {
					mui.toast('网络已断开...');
				}
			})
		}
		
		mui.plusReady(function () {
			
			
			// 禁止返回到注册登录页面
			mui.back = function(){
				
				return false;
			}
			
			// 监听网络连接变化
			listenNetworkChange();
			
			// 关闭所有waitingShow
			plus.nativeUI.closeWaiting();
			
			var _this = plus.webview.currentWebview();
			var cuit_chat = document.getElementById('cuit_chat');
			
			// 为四个子页面生成Webview对象
			for (var i = 0; i < child_pages.length; i++) {
					var child_page = plus.webview.create(child_pages[i].pageUrl, 
														 child_pages[i].pageId, 
														 {top: "44px", bottom: "50.4px"});
					child_page.hide();
					_this.append(child_page);
					
			}
			
			// 延时加载，触发四个子页面的数据更新
			setTimeout("initData()", "1000");
			
			// 如果是登录页面过来，那么等待3s缓存图片
			if (_this.isLogin != null && _this.isLogin != undefined && _this.isLogin == true){
					_this.show();
					_this.isLogin == null;
			}
			plus.webview.show(child_pages[0].pageId);  // 默认展示第一个
			
			// 子页面切换逻辑
			mui(".mui-bar-tab").on("tap", ".mui-tab-item", function(){
				
				var index = this.getAttribute("tabindex");
				changeHeader(index);
				plus.webview.show(child_pages[index].pageId, "slide-in-left", 200);
				for (var i = 0; i < child_pages.length; i++) {
					if(index != i)
						plus.webview.hide(child_pages[i].pageId, "slide-out-left", 200);
				}
			})
		})
    </script>
</html>