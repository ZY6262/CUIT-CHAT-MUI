{"version":3,"sources":["webpack:///E:/H5Plus/beautiful/main.js","webpack:///E:/H5Plus/beautiful/pages/index/be_index.vue?7292","webpack:///E:/H5Plus/beautiful/pages/index/be_index.vue?43d9","webpack:///E:/H5Plus/beautiful/pages/index/be_index.vue?779f","webpack:///E:/H5Plus/beautiful/pages/index/be_index.vue?33db","webpack:///E:/H5Plus/beautiful/pages/index/be_index.vue"],"names":["createPage","Page","data","PageCur","websocketUrl","metadata","badge","receiveMsgbadge","methods","NavChange","e","currentTarget","dataset","cur","changeBadge","friendRequest","groupRequest","onLoad","console","log","JSON","stringify","tokenPlus","userPlus","storageToken","getStorageToken","storageUser","getStorageUser","_this","uni","$on","res","undefined","showModal","title","showCancel","confirmText","content","complete","redirectTo","url","$store","commit","ajax","resetToken","timerId","setInterval","store","socketTask","connectSocket","success","fail","onOpen","senderId","state","user","id","model","MessageModel","send","keepAliveMsg","param","msg","onMessage","parse","String","action","friendService","fetchFriendsList","tmp","friendsPlus","getStorageFriendsList","$emit","payload","chatMsgPlus","getChatMsgRecords","receiveId","forEach","elem","msgId","isFriend","setChatMsgRecords","isRead","newMsg","Record","msgType","push","snapshot","getChatSnapshot","exam","i","length","isSender","splice","unshift","setChatSnapshot","onError","loadRequsetCount","messageService","pullAllNotSignMsg","onShow","hideLoading","computed","watch","val","mounted"],"mappings":"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","file":"pages/index/be_index.js","sourcesContent":["import 'uni-pages';import '@dcloudio/uni-stat';\n\nimport Vue from 'vue'\nimport Page from './pages/index/be_index.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./be_index.vue?vue&type=template&id=489ec626&\"\nvar renderjs\nimport script from \"./be_index.vue?vue&type=script&lang=js&\"\nexport * from \"./be_index.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../浏览器下载目录/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null,\n  false,\n  components,\n  renderjs\n)\n\n/* hot reload */\nif (module.hot) {\n  var api = require(\"E:\\\\浏览器下载目录\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\vue-hot-reload-api\\\\dist\\\\index.js\")\n  api.install(require('vue'))\n  if (api.compatible) {\n    module.hot.accept()\n    if (!api.isRecorded('489ec626')) {\n      api.createRecord('489ec626', component.options)\n    } else {\n      api.reload('489ec626', component.options)\n    }\n    module.hot.accept(\"./be_index.vue?vue&type=template&id=489ec626&\", function () {\n      api.rerender('489ec626', {\n        render: render,\n        staticRenderFns: staticRenderFns\n      })\n    })\n  }\n}\ncomponent.options.__file = \"H5Plus/beautiful/pages/index/be_index.vue\"\nexport default component.exports","export * from \"-!../../../../浏览器下载目录/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../浏览器下载目录/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--16-0!../../../../浏览器下载目录/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../浏览器下载目录/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../浏览器下载目录/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../浏览器下载目录/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./be_index.vue?vue&type=template&id=489ec626&\"","var components\nvar render = function() {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../../浏览器下载目录/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../浏览器下载目录/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../浏览器下载目录/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../浏览器下载目录/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../浏览器下载目录/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./be_index.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../浏览器下载目录/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../浏览器下载目录/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../浏览器下载目录/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../浏览器下载目录/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../浏览器下载目录/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./be_index.vue?vue&type=script&lang=js&\"","//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\n\nimport tokenPlus from '../../store/tokenplus.js'\nimport ajax from '../../utils/ajax.js'\nimport userPlus from '../../store/userplus.js'\nimport metadata from '../../utils/metadata.js'\nimport MessageModel from '../../common/MessageModel.js'\nimport friendService from '../../service/FriendService.js'\nimport friendsPlus from '../../store/friendsplus.js'\nimport Record from '../../common/RecordModel.js'\nimport chatMsgPlus from '../../store/chatmsgrecordsplus.js'\nimport messageService from '../../service/MessageService.js'\n\nexport default {\n\tdata() {\n\t\treturn {\n\t\t\tPageCur: 'mine',\n\t\t\twebsocketUrl: metadata.websocketUrl,\n\t\t\tbadge: 0,\n\t\t\treceiveMsgbadge: 0\n\t\t}\n\t},\n\tmethods: {\n\t\tNavChange: function(e) {\n\t\t\tthis.PageCur = e.currentTarget.dataset.cur\n\t\t},\n\t\tchangeBadge(){\n\t\t\tthis.badge = this.friendRequest + this.groupRequest\n\t\t}\n\t},\n\tonLoad: function(){\n\t\tconsole.log('----------启动检查')\n\t\tconsole.log(JSON.stringify(tokenPlus))\n\t\tconsole.log(JSON.stringify(userPlus))\n\t\tlet storageToken = tokenPlus.getStorageToken();\n\t\tlet storageUser = userPlus.getStorageUser();\n\t\tlet _this = this\n\t\tconsole.log(storageToken)\n\t\tconsole.log(storageUser)\n\t\t\n\t\t// 注册一个聊天消息角标变化监视器\n\t\tuni.$on('receiveMsgbadgeChange', function(res){\n\t\t\tconsole.log('收到了角标变化事件通知。receiveMsgbadge is ' + res)\n\t\t\t_this.receiveMsgbadge = res\n\t\t});\n\t\tif (storageUser == null || storageToken == '' || storageToken == null || storageToken == undefined) {\n\t\t\tconsole.log('准备跳转')\n\t\t\t// 跳转到登录页面\n\t\t\tuni.showModal({\n\t\t\t    title: '警告',\n\t\t\t    showCancel: false,\n\t\t\t\tconfirmText: '我知道了',\n\t\t\t\tcontent: '检查到您未登录',\n\t\t\t\tcomplete: function(){\n\t\t\t\t\tuni.redirectTo({\n\t\t\t\t\t\turl: '../account/login'\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t})\n\t\t} else {\n\t\t\tconsole.log('不准备跳转')\n\t\t\tif (storageUser != null) {\n\t\t\t\tconsole.log('更新User')\n\t\t\t\tconsole.log(storageUser)\n\t\t\t\tthis.$store.commit('resetUser', storageUser);\n\t\t\t}\n\t\t\t// 请求新token\n\t\t\tconsole.log('更新Token')\n\t\t\tthis.$store.commit('resetToken', storageToken);\n\t\t\tajax.resetToken(this.$store);\n\t\t\tlet timerId = setInterval(function(store){\n\t\t\t\tajax.resetToken(store)\n\t\t\t}, 50 * 60 * 1000, this.$store)\n\t\t\tthis.$store.commit('resetTimer', timerId)\n\t\t\t// 启动websocket\n\t\t\tlet socketTask = uni.connectSocket({\n\t\t\t\turl: this.websocketUrl,\n\t\t\t\tsuccess: function(){\n\t\t\t\t\tconsole.log('websocket打开成功')\n\t\t\t\t},\n\t\t\t\tfail: function(){\n\t\t\t\t\tconsole.log('websocket打开失败')\n\t\t\t\t}\n\t\t\t});\n\t\t\tsocketTask.onOpen(function(res){\n\t\t\t\t// 当连接上Netty服务器马上发送一个身份标识信息\n\t\t\t\tlet senderId = _this.$store.state.user.id\n\t\t\t\tlet model = new MessageModel(senderId, null, null, null, null, 'CONNECT', null)\n\t\t\t\tsocketTask.send({\n\t\t\t\t\tdata: JSON.stringify(model),\n\t\t\t\t\tsuccess: function(){\n\t\t\t\t\t\tconsole.log('身份标识信息已发送')\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t// 定时发送心跳包\n\t\t\t\tlet keepAliveMsg = new MessageModel(senderId, null, null, null, null, 'KEEP_ALIVE', null)\n\t\t\t\tsetInterval(function(param){\n\t\t\t\t\tparam.socketTask.send({\n\t\t\t\t\t\tdata: JSON.stringify(param.msg)\n\t\t\t\t\t})\n\t\t\t\t}, 30000, {socketTask: socketTask, msg: keepAliveMsg});\n\t\t\t});\n\t\t\tsocketTask.onMessage(function(data){\n\t\t\t\tconsole.log('监听 WebSocket 接受到服务器的消息事件')\n\t\t\t\t// console.log(JSON.stringify(data))\n\t\t\t\tconsole.log(data.data)\n\t\t\t\tlet res = JSON.parse(data.data)\n\t\t\t\t console.log(data.data instanceof String)\n\t\t\t\tconsole.log(\"data action is \" + res.action)\n\t\t\t\tif (res.action == 'FRIEND_REQUEST') {\n\t\t\t\t\tconsole.log('更新角标')\n\t\t\t\t\t_this.$store.commit('resetFriendRequest', 1)\n\t\t\t\t} else if (res.action == 'FRIEND_REQUEST_AGREE' || res.action == 'FRIEND_DELETE') {\n\t\t\t\t\tconsole.log('好友关系有变动')\n\t\t\t\t\tfriendService.fetchFriendsList(_this)\n\t\t\t\t\tlet tmp = friendsPlus.getStorageFriendsList()\n\t\t\t\t\tuni.$emit('refreshFriendsList', tmp)\n\t\t\t\t} else if (res.action == 'IS_NOT_FRIEND') {\n\t\t\t\t\tconsole.log('对方不是你的好友，消息发送失败')\n\t\t\t\t\tconsole.log(res.payload)\n\t\t\t\t\tconsole.log(res.payload.senderId)\n\t\t\t\t\t// 通过消息ID更新消息记录的isFriend值就行了,可管可不管快照\n\t\t\t\t\tvar tmp = chatMsgPlus.getChatMsgRecords(_this.$store.state.user.id, res.payload.receiveId)\n\t\t\t\t\ttmp.forEach(elem => {\n\t\t\t\t\t\tif (elem.msgId == res.payload.msgId) {\n\t\t\t\t\t\t\telem.isFriend = false\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tchatMsgPlus.setChatMsgRecords(_this.$store.state.user.id, res.payload.receiveId, tmp)\n\t\t\t\t\t// 更新聊天页面显示\n\t\t\t\t\tuni.$emit('refreshRecordsList', tmp)\n\t\t\t\t} else if (res.action == 'PUSH_CHAT_MSG') {\n\t\t\t\t\tconsole.log('收到好友发送的消息')\n\t\t\t\t\tconsole.log(res.payload)\n\t\t\t\t\tconsole.log(res.payload.senderId)\n\t\t\t\t\tvar isRead = false\n\t\t\t\t\tlet newMsg = new Record(res.payload.msgId, res.payload.senderId, res.payload.receiveId, res.payload.msg, res.payload.msgType, isRead, true)\n\t\t\t\t\t\n\t\t\t\t\tvar tmp = chatMsgPlus.getChatMsgRecords(newMsg.receiveId, newMsg.senderId)\n\t\t\t\t\ttmp.push(newMsg);\n\t\t\t\t\tchatMsgPlus.setChatMsgRecords(newMsg.receiveId, newMsg.senderId, tmp)\n\t\t\t\t\t// 更新聊天页面显示\n\t\t\t\t\tuni.$emit('refreshRecordsList', tmp)\n\t\t\t\t\t\n\t\t\t\t\t// 更新聊天快照\n\t\t\t\t\tvar snapshot = chatMsgPlus.getChatSnapshot(newMsg.receiveId)\n\t\t\t\t\tvar exam = null\n\t\t\t\t\tfor(let i = 0; i < snapshot.length; i++) {\n\t\t\t\t\t\tif (snapshot[i].isSender) {\n\t\t\t\t\t\t\tif (snapshot[i].senderId == newMsg.receiveId) {\n\t\t\t\t\t\t\t\texam = snapshot[i]\n\t\t\t\t\t\t\t\tnewMsg.badge = exam.isRead ? (newMsg.isRead ? 0 : 1) : (exam.badge + 1)\n\t\t\t\t\t\t\t\tsnapshot.splice(i, 1)\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tif (snapshot[i].senderId == newMsg.senderId) {\n\t\t\t\t\t\t\t\texam = snapshot[i]\n\t\t\t\t\t\t\t\tnewMsg.badge = exam.isRead ? (newMsg.isRead ? 0 : 1) : (exam.badge + 1)\n\t\t\t\t\t\t\t\tsnapshot.splice(i, 1)\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (exam == null) {\n\t\t\t\t\t\tnewMsg.badge = newMsg.isRead ? 0 : 1\n\t\t\t\t\t}\n\t\t\t\t\tnewMsg.isSender = false\n\t\t\t\t\tsnapshot.unshift(newMsg);\n\t\t\t\t\tchatMsgPlus.setChatSnapshot(newMsg.receiveId, snapshot);\n\t\t\t\t\tuni.$emit('refreshSnapShot', snapshot)\n\t\t\t\t}\n\t\t\t});\n\t\t\tsocketTask.onError(function(){\n\t\t\t\tconsole.log('WebSocket 错误事件的回调函数')\n\t\t\t})\n\t\t\tthis.$store.commit('resetMessager', socketTask)\n\t\t\t// 拉取好友列表\n\t\t\tconsole.log('拉取好友列表')\n\t\t\tfriendService.fetchFriendsList(this);\n\t\t\t// 拉取好友请求\n\t\t\tfriendService.loadRequsetCount(this)\n\t\t\t// 拉取未签收消息\n\t\t\tmessageService.pullAllNotSignMsg(this)\n\t\t}\n\t\t\n\t},\n\tonShow: function(){\n\t\tuni.hideLoading()\n\t},\n\tcomputed: {\n\t\tfriendRequest(){\n\t\t\treturn this.$store.state.badge.friendRequest\n\t\t},\n\t\tgroupRequest(){\n\t\t\treturn this.$store.state.badge.groupRequest\n\t\t}\n\t},\n\twatch: {\n\t\tfriendRequest(val) {\n\t\t\tthis.changeBadge()\n\t\t},\n\t\tgroupRequest(val){\n\t\t\tthis.changeBadge()\n\t\t}\n\t},\n\tmounted: function(){\n\t\tthis.changeBadge()\n\t}\n}\n"],"sourceRoot":""}